-- Tabela de usuários
CREATE TABLE alunos_turma (
  id_aluno_turma int(11) NOT NULL AUTO_INCREMENT,
  id_aluno int(11) DEFAULT NULL,
  id_turma int(11) DEFAULT NULL,
  PRIMARY KEY (id_aluno_turma),
  UNIQUE KEY id_aluno (id_aluno,id_turma),
  KEY id_turma (id_turma),
  CONSTRAINT alunos_turma_ibfk_1 FOREIGN KEY (id_aluno) REFERENCES usuarios (id_usuario) ON DELETE CASCADE,
  CONSTRAINT alunos_turma_ibfk_2 FOREIGN KEY (id_turma) REFERENCES turmas (id_turma) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

CREATE TABLE atividades (
  id_atividade int(11) NOT NULL AUTO_INCREMENT,
  id_disciplina int(11) DEFAULT NULL,
  id_turma int(11) DEFAULT NULL,
  id_professor int(11) DEFAULT NULL,
  titulo varchar(255) NOT NULL,
  descricao text NOT NULL,
  data_atividade date NOT NULL,
  dificuldade enum('Fácil','Médio','Difícil') NOT NULL,
  data_criacao timestamp NULL DEFAULT current_timestamp(),
  PRIMARY KEY (id_atividade),
  KEY id_disciplina (id_disciplina),
  KEY id_turma (id_turma),
  KEY id_professor (id_professor),
  CONSTRAINT atividades_ibfk_1 FOREIGN KEY (id_disciplina) REFERENCES disciplinas (id_disciplina) ON DELETE CASCADE,
  CONSTRAINT atividades_ibfk_2 FOREIGN KEY (id_turma) REFERENCES turmas (id_turma) ON DELETE CASCADE,
  CONSTRAINT atividades_ibfk_3 FOREIGN KEY (id_professor) REFERENCES usuarios (id_usuario) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

CREATE TABLE desempenho (
  id_desempenho int(11) NOT NULL AUTO_INCREMENT,
  id_aluno int(11) DEFAULT NULL,
  id_disciplina int(11) DEFAULT NULL,
  id_atividade int(11) DEFAULT NULL,
  nota decimal(5,2) DEFAULT NULL,
  feedback_professor text DEFAULT NULL,
  data_registro timestamp NULL DEFAULT current_timestamp(),
  PRIMARY KEY (id_desempenho),
  KEY id_aluno (id_aluno),
  KEY id_disciplina (id_disciplina),
  KEY id_atividade (id_atividade),
  CONSTRAINT desempenho_ibfk_1 FOREIGN KEY (id_aluno) REFERENCES usuarios (id_usuario) ON DELETE CASCADE,
  CONSTRAINT desempenho_ibfk_2 FOREIGN KEY (id_disciplina) REFERENCES disciplinas (id_disciplina) ON DELETE CASCADE,
  CONSTRAINT desempenho_ibfk_3 FOREIGN KEY (id_atividade) REFERENCES atividades (id_atividade) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

CREATE TABLE disciplinas (
  id_disciplina int(11) NOT NULL AUTO_INCREMENT,
  nome_disciplina varchar(255) NOT NULL,
  PRIMARY KEY (id_disciplina)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

CREATE TABLE professores_disciplina (
  id_professor_disciplina int(11) NOT NULL AUTO_INCREMENT,
  id_professor int(11) DEFAULT NULL,
  id_disciplina int(11) DEFAULT NULL,
  PRIMARY KEY (id_professor_disciplina),
  UNIQUE KEY id_professor (id_professor,id_disciplina),
  KEY id_disciplina (id_disciplina),
  CONSTRAINT professores_disciplina_ibfk_1 FOREIGN KEY (id_professor) REFERENCES usuarios (id_usuario) ON DELETE CASCADE,
  CONSTRAINT professores_disciplina_ibfk_2 FOREIGN KEY (id_disciplina) REFERENCES disciplinas (id_disciplina) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

CREATE TABLE professores_turma (
  id_professor_turma int(11) NOT NULL AUTO_INCREMENT,
  id_professor int(11) DEFAULT NULL,
  id_turma int(11) DEFAULT NULL,
  PRIMARY KEY (id_professor_turma),
  UNIQUE KEY id_professor (id_professor,id_turma),
  KEY id_turma (id_turma),
  CONSTRAINT professores_turma_ibfk_1 FOREIGN KEY (id_professor) REFERENCES usuarios (id_usuario) ON DELETE CASCADE,
  CONSTRAINT professores_turma_ibfk_2 FOREIGN KEY (id_turma) REFERENCES turmas (id_turma) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

CREATE TABLE registros_atividade (
  id_registro int(11) NOT NULL AUTO_INCREMENT,
  id_atividade int(11) DEFAULT NULL,
  id_aluno int(11) DEFAULT NULL,
  id_disciplina int(11) DEFAULT NULL,
  grau_dificuldade enum('Baixa','Moderada','Alta') NOT NULL,
  comentario_dificuldade text DEFAULT NULL,
  tempo_gasto int(11) DEFAULT NULL,
  feedback_professor text DEFAULT NULL,
  anexo_atividade varchar(255) DEFAULT NULL,
  data_entrega timestamp NULL DEFAULT current_timestamp(),
  PRIMARY KEY (id_registro),
  KEY id_atividade (id_atividade),
  KEY id_aluno (id_aluno),
  KEY id_disciplina (id_disciplina),
  CONSTRAINT registros_atividade_ibfk_1 FOREIGN KEY (id_atividade) REFERENCES atividades (id_atividade) ON DELETE CASCADE,
  CONSTRAINT registros_atividade_ibfk_2 FOREIGN KEY (id_aluno) REFERENCES usuarios (id_usuario) ON DELETE CASCADE,
  CONSTRAINT registros_atividade_ibfk_3 FOREIGN KEY (id_disciplina) REFERENCES disciplinas (id_disciplina) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

CREATE TABLE turmas (
  id_turma int(11) NOT NULL AUTO_INCREMENT,
  nome_turma varchar(100) NOT NULL,
  turno enum('Manhã','Tarde','Noite') NOT NULL,
  data_criacao timestamp NULL DEFAULT current_timestamp(),
  PRIMARY KEY (id_turma)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

CREATE TABLE usuarios (
  id_usuario int(11) NOT NULL AUTO_INCREMENT,
  nome_completo varchar(255) NOT NULL,
  email varchar(255) NOT NULL,
  senha varchar(255) NOT NULL,
  telefone varchar(15) DEFAULT NULL,
  foto_url varchar(255) DEFAULT NULL,
  sexo enum('Masculino','Feminino','Outro','Não informar') DEFAULT 'Não informar',
  tipo_usuario enum('Aluno','Professor','Coordenador','Administrador') NOT NULL DEFAULT 'Aluno',
  status enum('Ativo','Inativo') DEFAULT 'Ativo',
  data_criacao timestamp NULL DEFAULT current_timestamp(),
  PRIMARY KEY (id_usuario),
  UNIQUE KEY email (email)
) ENGINE=InnoDB AUTO_INCREMENT=6 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

